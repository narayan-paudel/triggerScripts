#!/usr/bin/env python

import os
import sys
import subprocess

from I3Tray import I3Tray, I3Units
from icecube.simprod import segments
from icecube.simprod.util import simprodtray, arguments
from icecube.simprod.util import ReadI3Summary, WriteI3Summary
from icecube import icetray, dataclasses, dataio
from icecube.simprod.util.simprodtray import RunI3Tray
import argparse
import icecube.icetray
import math
from icecube import phys_services, sim_services
from icecube import tableio, hdfwriter
from icecube.simprod.util import PrintContext
from icecube import topeventcleaning, tpx


outputDir = "/home/enpaudel/icecube/triggerStudy/simFiles/dataSetTest/"

GCD="/data/user/enpaudel/triggerStudy/simFiles/GeoCalibDetectorStatus_2020.Run135057.Pass2_V0_Snow210305NoDomSetTankTrig.i3.gz"

import argparse
parser = argparse.ArgumentParser()
parser.add_argument('input', type=str, nargs='+', default="/home/enpaudel/icecube/triggerStudy/simFiles/ITGenTest/FeDAT000001GenDet.i3.bz2", help='Input files after running detector.py.')
args = parser.parse_args()

tank7OnlyEventID = [52107, 52157, 52181, 203164, 232138, 232174, 232175, 232185, 232191, 324180, 324197,
622119, 623142, 652116, 652192, 655175, 862179, 1102142, 1192146, 1402130, 1402159, 1402189, 1492108,
1492112, 1492161, 1492178, 1492187, 1492191, 1492196, 1552133, 1552196, 1612144, 2184179, 2212112,
2212181, 2362102, 2362128, 2362144, 2362187, 2572117, 2572165, 2753109, 2753140, 2753176, 2753184, 2934109,
2934167, 3563103, 3563127, 3832119, 3864142, 3864144, 3864152, 3984163, 3985134, 3985147, 3985148, 4162105,
4162116, 4162144, 4162153, 4162161, 4192106, 4192131, 4192159, 4192172, 4584103, 4584199, 4673159, 4673173,
4673186, 4673197, 4824152, 5125159, 5423150, 5454116, 5572138, 5722136, 5875108, 5875124, 5875145, 52244,
52275, 52292, 232213, 232226, 232254, 232271, 323293, 352273, 352275, 443229, 443237, 443243, 443244, 443294,
444256, 444273, 444286, 475215, 563283, 592237, 592268, 592284, 592291, 804244, 1162226, 1162244, 1522211,
1522239, 1522256, 1522287, 1552212, 1552224, 1552233, 1552248, 1552267, 1552288, 1554230, 1554237, 1612233,
1612287, 1702207, 1794232, 1853283, 1853285, 2092249, 2092278, 2093214, 2093224, 2274247, 2423253, 2423266,
2423298, 2453205, 2453252, 2513270, 2662213, 2662243, 2662245, 3084295, 3142232, 3142297, 3262293, 3534232,
3742219, 3892296, 3893244, 3984232, 3984275, 4044214, 4073224, 4073286, 4434229, 4434295, 4523208, 4523267,
4523299, 4702231, 4852201, 4852205, 4852216, 4852232, 4852256, 4852298, 5123249, 5123264, 5123291, 5272205,
5272219, 5272225, 5274205, 5393236, 5393251, 5573289, 5692247, 5692295, 5753207, 5753281, 5935295, 682344,
682378, 1042306, 1042314, 1042319, 1042325, 1042347, 1042364, 1042373, 1372323, 1372397, 1672312, 1672330,
1672374, 1733305, 1733308, 1733314, 1733384, 1823339, 1882363, 1883319, 2002390, 2182345, 2214346, 2512319,
2722353, 2902306, 2902315, 2902340, 2902342, 2902377, 2935311, 2935351, 2992352, 3173361, 3322326, 3412319,
3564340, 3684361, 3804375, 3954392, 3984342, 3984393, 4102317, 4163341, 4402347, 4402382, 4435357, 4552338,
4552344, 4552387, 4642328, 4642391, 4972308, 4972346, 4972353, 4972354, 4975324, 5004388, 5032312, 5063317,
5243393, 5512370, 5632335, 5632347, 5632354, 5632363, 5632366, 5632372, 5632388, 5873353, 653400, 653411,
653464, 653490, 742439, 742469, 1102417, 1102471, 1102472, 1163444, 1553412, 1553457, 1584491, 1615498,
1645434, 1883429, 1883451, 1883463, 1883497, 2035480, 2212498, 3054445, 3112455, 3142423, 3324425, 3593450,
3772421, 3772459, 3833437, 4252450, 4522414, 4522430, 4522489, 4583407, 4583422, 4583427, 4583466, 5123492,
5514475, 5722474, 5782449, 5842406, 5842458, 5992440, 5992495]
tank7HLC6EventID = [85100, 85137, 85163, 85194, 85195, 265102, 265118, 265133, 265151, 265152, 265199, 475119,
 475144, 475178, 475186, 535123, 535139, 535142, 535149, 535175, 535183, 535185, 655112, 655113, 655119, 655134,
655142, 655146, 655155, 655178, 655179, 655180, 835102, 835104, 835106, 835120, 835132, 835167, 835175, 835192,
985170, 1225105, 1225113, 1225132, 1225155, 1225172, 1225185, 1225193, 1225199, 1255102, 1255106, 1255126, 1255141,
1255157, 1255191, 1465106, 1465107, 1465111, 1465140, 1465161, 1465187, 1495118, 1495169, 1495175, 1495180, 1495181,
2035101, 2035118, 2035176, 2035180, 2035190, 2035197, 2095112, 2095139, 2095142, 2095177, 2425115, 2425151, 2425178,
2425196, 2665102, 2665114, 2665150, 2665180, 2755111, 2755129, 2755145, 2755164, 3085119, 3085173, 3445115, 3445119,
3445153, 3445192, 3475100, 3475119, 3475125, 3475172, 3475193, 3505110, 3505117, 3505135, 3505137, 3505140, 3505145,
3505189, 3505197, 3985107, 3985119, 3985143, 3985153, 3985167, 4045124, 4045134, 4045154, 4045157, 4045179, 4045180,
4255111, 4255119, 4255122, 4255144, 4255155, 4255163, 4255183, 4255198, 4585133, 4585137, 4585143, 4585170, 4585181,
4585183, 4585189, 4585191, 4645104, 4645107, 4645123, 4645129, 4645152, 4645198, 5125102, 5125139, 5125149, 5125174,
5185108, 5185118, 5185152, 5185168, 5185182, 5185198, 5185199, 5215102, 5215111, 5215122, 5215146, 5215172, 5215178,
5215179, 5215181, 5215188, 5395107, 5395125, 5395129, 5395153, 5395158, 5395163, 5395184, 5395196, 5455115, 5455135,
5455150, 5455182, 5455193, 5665108, 5665137, 5665139, 5665153, 5665159, 5665166, 5665167, 5665171, 5665181, 5665185,
5665191, 5875139, 5875149, 5875174, 5875195, 25218, 25240, 25255, 25277, 25281, 25296, 55219, 55242, 55286, 475213,
475216, 475233, 595249, 595257, 595264, 595277, 595287, 595295, 895207, 895239, 895244, 895251, 895265, 895284, 895298,
1405238, 1405276, 1405291, 1495216, 1495225, 1495226, 1495233, 1495257, 1495287, 1615241, 1615263, 1615276, 1615283, 1615284,
1645202, 1645262, 1645267, 1645284, 1675210, 1675212, 1675279, 1705203, 1705211, 1705228, 1705235, 1705244, 1705248, 1705255,
1705259, 1705276, 1705280, 1795211, 1795224, 1795230, 1795248, 1795259, 1795264, 1795296, 2095215, 2095230, 2095232, 2095238,
 2095257, 2095261, 2095263, 2095268, 2095295, 2155235, 2155259, 2155281, 2155296, 2155298, 2245206, 2245234, 2245258,
2245260, 2245264, 2245275, 2605203, 2605224, 2605243, 2605258, 2605278, 2935217, 2935221, 2935231, 2935284, 2935299,
2965209, 2965297, 3055206, 3055209, 3055218, 3055235, 3055281, 3655209, 3655238, 3655240, 3655283, 3655287, 3715225,
3715234, 3715247, 3715257, 3715266, 3715275, 3715281, 3715296, 5035244, 5035262, 5035271, 325342, 325386, 325398, 355305,
355307, 355313, 355315, 355341, 355358, 355361, 355373, 595312, 595316, 595350, 595365, 985312, 985316, 985343, 985344, 985363,
985389, 985393, 985396, 1045311, 1045314, 1045328, 1045344, 1045360, 1045366, 1045370, 1645345, 1645362, 1825344, 1825377, 1825387,
1915314, 1915320, 1915336, 1915361, 1915364, 1915375, 1915396, 2935319, 2935326, 2935345, 2935374, 2935391, 2935399, 3115304, 3115350,
 3115359, 3115361, 3115373, 3475325, 3475351, 3595310, 3595316, 3595337, 3595348, 3595349, 3595350, 3595355, 3595361, 3595365, 3595374,
3595387, 3625310, 3625328, 3625382, 3925308, 3925311, 3925316, 3925331, 3925334, 3925346, 3925364, 3925387, 3925397, 4375301, 4375310,
4375312, 4375371, 4375379, 4435306, 4435367, 4435379, 4435391, 4705301, 4705331, 4705333, 4705334, 4705356, 4705364, 4705392, 4705395,
4975305, 4975347, 4975351, 4975368, 4975387, 4975390, 4975394, 5215321, 5215332, 5215338, 5215345, 5215351, 5215391, 5455340, 5455353,
5455357, 5455365, 5455371, 5455395, 5485312, 5485344, 5515395, 5545305, 5545338, 5545343, 5545377, 5545383, 5545390, 5755308, 5755331,
5755363, 5755369, 5755399, 5785301, 5785311, 5785337, 5785366, 5785367, 5785369, 5845317, 5845318, 5845359, 5845373, 5845376, 25426, 25431,
25434, 25439, 25443, 25462, 25473, 415400, 415441, 415444, 415447, 415453, 415455, 415483, 475402, 475426, 475432, 475455, 475477, 475488,
565404, 565406, 565408, 565434, 565440, 565451, 565473, 565486, 1165409, 1165438, 1165486, 1525412, 1525428, 1525465, 1525468, 1525478, 1615408,
1615451, 1615467, 1615471, 1615474, 1615493, 1645404, 1645460, 1645476, 1645479, 1645499, 1675401, 1675403, 1675406, 1675492, 1675499, 1735446,
1735447, 1735489, 1735499, 2035404, 2035431, 2035439, 2035495, 2065410, 2065417, 2065451, 2065465, 2065468, 2065494, 2125418, 2125441, 2125452,
2125458, 2125459, 2125468, 2125499, 2305413, 2305416, 2305477, 2305484, 2335405, 2335434, 2335464, 2335466, 2335477, 2665400, 2665407, 2665421,
2665433, 2665434, 2665460, 2665465, 2665477, 2665490, 2695415, 2845459, 2905400, 2905428, 2905434, 2905447, 2905462, 2905474, 2905483, 2905485,
2905491, 3025405, 3025421, 3025426, 3025451, 3025463, 3025474, 3025482, 3025496, 3205409, 3205417, 3205431, 3205447, 3205474, 3235414, 3235420,
3235454, 3235478, 3235499, 3745433, 3745450, 3745456, 3745457, 3745492, 3985417, 3985426, 3985430, 3985457, 3985462, 3985485, 4075402, 4075406,
4075415, 4075419, 4075424, 4075427, 4075432, 4075441, 4075452, 4075465, 4075472, 4165436, 4165455, 4165457, 4165460, 4165462, 4165481, 4165491,
4435403, 4435404, 4435417, 4435463, 4435469, 4435477, 4435485, 4825450, 4825487, 5155427, 5155430, 5155433, 5155457, 5155475, 5185406, 5185437,
5185438, 5185440, 5185470, 5185473, 5185475, 5185477, 5515400, 5515407, 5515418, 5515422, 5515424, 5515441, 5515442, 5515459, 5515461, 5635400,
5635444, 5635471, 5635474, 5635498, 5785462, 5785479, 5785484, 5845419, 5845421, 5845449]

def selectTank7Only(frame):
	if frame.Has("I3EventHeader"):
		# if frame["I3EventHeader"].event_id not in tank7OnlyEventID:
		if frame["I3EventHeader"].event_id not in tank7HLC6EventID:
			return False

tray = I3Tray()
tray.AddModule("I3Reader","reader",
	           filenameList=[GCD]+args.input,
	          )

tray.AddModule(selectTank7Only,"tank7",
				streams=[icetray.I3Frame.DAQ,icetray.I3Frame.Physics])

tray.AddModule("I3Writer","i3writer",
	          filename=str(outputDir)+"tank7HLC6.i3.gz",
	          streams=[icetray.I3Frame.TrayInfo,icetray.I3Frame.Geometry,icetray.I3Frame.Calibration,icetray.I3Frame.DetectorStatus,icetray.I3Frame.DAQ,icetray.I3Frame.Physics],
	          )
tray.Execute()
tray.Finish()